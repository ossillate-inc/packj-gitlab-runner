stages: # List of stages for jobs, and their order of execution
  - build
  - test
  - deploy

build-job: # This job runs in the build stage, which runs first.
  stage: build
  image: python:latest
  script:
    - echo "Pulling Python from Docker..."
    - git clone https://github.com/ossillate-inc/packj
    - python3 -m venv venv
    - pip3 install -r ./packj/requirements.txt

unit-test-job:
  stage: test
  script:
    - echo "Auditing packages with Packj..."
    - python3 ./packj/main.py audit -f requirements.txt

lint-test-job: # This job also runs in the test stage.
  stage: test # It can run at the same time as unit-test-job (in parallel).
  script:
    - echo "Linting code... This will take about 10 seconds."
    - sleep 10
    - echo "No lint issues found."

deploy-job: # This job runs in the deploy stage.
  stage: deploy # It only runs when *both* jobs in the test stage complete successfully.
  environment: production
  script:
    - echo "Deploying application..."
    - echo "Application successfully deployed."
